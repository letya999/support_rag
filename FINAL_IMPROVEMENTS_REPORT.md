# ๐ ะััะตั ะพ ัะธะฝะฐะปัะฝัั ัะปัััะตะฝะธัั ะฐััะธัะตะบัััั

**ะะฐัะฐ:** 2026-01-09  
**ะกัะฐััั:** โ ะัะฟะพะปะฝะตะฝะพ

---

## โ ะัะฟะพะปะฝะตะฝะฝัะต ะธะทะผะตะฝะตะฝะธั

### 1. ะัะธััะบะฐ ะธะผะฟะพััะพะฒ ะฒ `app/api/rag_routes.py`

**ะฃะดะฐะปะตะฝั ะฝะตะธัะฟะพะปัะทัะตะผัะต ะธะผะฟะพััั:**
- โ `from app.nodes.retrieval.search import retrieve_context` - ะฝะต ะธัะฟะพะปัะทัะตััั
- โ `from app.integrations.embeddings import get_embedding` - ะฝะต ะธัะฟะพะปัะทัะตััั  
- โ `from app.storage.vector_store import search_documents` - ะดัะฑะปะธััะตั ะปะพะบะฐะปัะฝัะน ะธะผะฟะพัั

**ะะตะทัะปััะฐั:** ะะพะด ัะธัะต, ะฝะตั ะฝะตะธัะฟะพะปัะทัะตะผัั ะทะฐะฒะธัะธะผะพััะตะน

---

### 2. ะะตะพัะณะฐะฝะธะทะฐัะธั ัะตัะฒะธัะพะฒ

#### โ config_manager.py
**ะัะปะพ:** `app/services/config_manager.py`  
**ะกัะฐะปะพ:** `app/services/config_loader/config_manager.py`

**ะะฑะฝะพะฒะปะตะฝะพ:**
- โ `app/services/config_loader/__init__.py` - ะดะพะฑะฐะฒะปะตะฝ ัะบัะฟะพัั `ConfigManager`
- โ `app/api/config_routes.py` - ะพะฑะฝะพะฒะปะตะฝ ะธะผะฟะพัั ะฝะฐ `from app.services.config_loader import ConfigManager`

**ะะพะณะธะบะฐ:** `ConfigManager` ะปะพะณะธัะตัะบะธ ะพัะฝะพัะธััั ะบ `config_loader` ะผะพะดัะปั

#### โ search.py โ search/search_service.py
**ะัะปะพ:** `app/services/search.py`  
**ะกัะฐะปะพ:** `app/services/search/search_service.py`

**ะกะพะทะดะฐะฝะพ:**
- โ `app/services/search/__init__.py` - ัะบัะฟะพััะธััะตั `search_documents`, `search_lexical`

**ะะฑะฝะพะฒะปะตะฝะพ:**
- โ `app/api/rag_routes.py` - ะธัะฟะพะปัะทัะตั `from app.services.search import search_documents`

**ะะพะณะธะบะฐ:** ะะพะดะณะพัะพะฒะบะฐ ะบ ัะฐััะธัะตะฝะธั search ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ (hybrid search, filters ะธ ั.ะด.)

#### โ metadata_analyzer.py
**ะัะปะพ:** `app/services/metadata_analyzer.py`  
**ะกัะฐะปะพ:** `app/services/metadata_generation/metadata_analyzer.py`

**ะะฑะฝะพะฒะปะตะฝะพ:**
- โ `app/services/metadata_generation/__init__.py` - ะดะพะฑะฐะฒะปะตะฝ ัะบัะฟะพัั `MetadataAnalyzerService`

**ะะพะณะธะบะฐ:** `MetadataAnalyzerService` - ััะพ ัะฐััั metadata_generation ะฟะพะดัะธััะตะผั

---

### 3. ะะตัะฐะบัะพัะธะฝะณ `app/main.py`

#### ะัะพะฑะปะตะผั ะฒ ััะฐัะพะผ main.py:
- โ 206 ัััะพะบ (ัะปะธัะบะพะผ ะผะฝะพะณะพ)
- โ Admin endpoints (110-205 ัััะพะบะธ) ัะผะตัะฐะฝั ั ะพัะฝะพะฒะฝัะผ ะฟัะธะปะพะถะตะฝะธะตะผ
- โ Warmup ะปะพะณะธะบะฐ (48-78 ัััะพะบะธ) ะฒัััะพะตะฝะฐ ะฒ lifespan
- โ ะัะฑะปะธััััะธะตัั ะธะผะฟะพััั
- โ ะััะผัะต ะธะผะฟะพััั ะธะท nodes (ะฝะฐัััะตะฝะธะต ะฐััะธัะตะบัััั)

#### โ ะกะพะทะดะฐะฝ `app/api/admin_routes.py`
**ะะฐะทะผะตั:** 105 ัััะพะบ  
**Endpoints:**
- `GET /admin/cache/status` - ััะฐััั ะบะตัะฐ
- `POST /admin/refresh-intents` - ะพะฑะฝะพะฒะปะตะฝะธะต ัะตะตัััะฐ ะธะฝัะตะฝัะพะฒ
- `GET /admin/intents-registry` - ะฟัะพัะผะพัั ัะตะตัััะฐ

**ะะพะณะธะบะฐ:** Admin ััะฝะบัะธะพะฝะฐะปัะฝะพััั ะดะพะปะถะฝะฐ ะฑััั ะฒ ะพัะดะตะปัะฝะพะผ ัะพััะตัะต

#### โ ะกะพะทะดะฐะฝ `app/services/warmup_service.py`  
**ะะฐะทะผะตั:** 60 ัััะพะบ  
**ะะปะฐัั:** `WarmupService`
**ะะตัะพะดั:**
- `warmup_all()` - ะฟัะพะณัะตะฒ ะฒัะตั ะผะพะดะตะปะตะน
- `warmup_embeddings_only()` - ะฑัััััะน ะฟัะพะณัะตะฒ

**ะะพะณะธะบะฐ:** Warmup - ััะพ ะพัะดะตะปัะฝะฐั ะพัะฒะตัััะฒะตะฝะฝะพััั, ะฝะต ะดะพะปะถะฝะฐ ะฑััั ะฒ main.py

#### โ ะะพะฒัะน `app/main.py`
**ะะฐะทะผะตั:** 71 ัััะพะบะฐ (ะฑัะปะพ 206!)  
**ะฃะปัััะตะฝะธั:**
- โ ะงะธัััะน entry point
- โ ะะตะปะตะณะธััะตั warmup ะฒ `WarmupService`
- โ ะะตะปะตะณะธััะตั admin endpoints ะฒ `admin_routes`
- โ ะะตั ะดัะฑะปะธััััะธััั ะธะผะฟะพััะพะฒ
- โ ะะตั ะฟััะผัั ะธะผะฟะพััะพะฒ ะธะท nodes

**ะะพะด:**
```python
from app.services.warmup_service import WarmupService

@asynccontextmanager
async def lifespan(app: FastAPI):
    # ... ะธะฝะธัะธะฐะปะธะทะฐัะธั ...
    await WarmupService.warmup_all()
    yield
    # ... cleanup ...
```

---

### 4. ะัะฟัะฐะฒะปะตะฝ `requirements.txt`

**ะัะพะฑะปะตะผะฐ:** `llm-guard>=0.3.0python-docx>=0.8.11` - ะดะฒะต ะทะฐะฒะธัะธะผะพััะธ ัะบะปะตะตะฝั

**ะัะฟัะฐะฒะปะตะฝะพ:**
```txt
llm-guard>=0.3.0
python-docx>=0.8.11
```

**ะะตะทัะปััะฐั:** `ModuleNotFoundError: No module named 'docx'` ะฑะพะปััะต ะฝะต ะฑัะดะตั

---

## ๐ ะัะพะณะพะฒะฐั ััััะบัััะฐ

### ะกะตัะฒะธัั ะพัะณะฐะฝะธะทะพะฒะฐะฝั ะฟะพ ะดะพะผะตะฝะฐะผ:

```
app/services/
โโโ batch_processors/
โโโ cache/
โโโ classification/
โ   โโโ semantic_service.py
โโโ config_loader/
โ   โโโ config_manager.py      # โ ะะะะะะะกะขะะะ ััะดะฐ
โ   โโโ loader.py
โ   โโโ node_registry.py
โโโ dialog/
โโโ document_loaders/
โโโ ingestion/
โโโ metadata_generation/
โ   โโโ analyzer.py
โ   โโโ metadata_analyzer.py   # โ ะะะะะะะกะขะะะ ััะดะฐ
โ   โโโ ...
โโโ qa_extractors/
โโโ qa_validators/
โโโ search/                     # โ ะะะะะฏ ััััะบัััะฐ
โ   โโโ __init__.py
โ   โโโ search_service.py      # โ ะะะะะะะกะขะะะ ััะดะฐ
โโโ structure_detectors/
โโโ text_processors/
โโโ translation/
โโโ warmup_service.py          # โ ะะะะซะ ัะฐะนะป
```

### API ะพัะณะฐะฝะธะทะพะฒะฐะฝ ะฟะพ ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ:

```
app/api/
โโโ __init__.py
โโโ main.py                    # ะะณัะตะณะฐัะพั ัะพััะตัะพะฒ
โโโ admin_routes.py           # โ ะะะะซะ ัะฐะนะป
โโโ config_routes.py
โโโ document_routes.py
โโโ metadata_routes.py
โโโ rag_routes.py
```

---

## ๐ ะะตััะธะบะธ ัะปัััะตะฝะธะน

| ะะตััะธะบะฐ | ะะพ | ะะพัะปะต | ะฃะปัััะตะฝะธะต |
|---------|-----|-------|-----------|
| **ะะฐะทะผะตั main.py** | 206 ัััะพะบ | 71 ัััะพะบะฐ | โ -65% |
| **ะคะฐะนะปะพะฒ API** | 4 | 5 | โ +1 (admin) |
| **ะะตะธัะฟะพะปัะทัะตะผัั ะธะผะฟะพััะพะฒ** | 3 | 0 | โ -100% |
| **ะัะฑะปะธััััะธััั ะธะผะฟะพััะพะฒ** | 2 | 0 | โ -100% |
| **ะััะผัั ะธะผะฟะพััะพะฒ ะธะท nodes ะฒ main** | 4 | 0 | โ -100% |

---

## โ ะัะธะฝัะธะฟั ัะพะฑะปัะดะตะฝั

1. โ **SRP (Single Responsibility):**
   - main.py - ัะพะปัะบะพ entry point
   - admin_routes.py - ัะพะปัะบะพ admin ััะฝะบัะธะธ
   - warmup_service.py - ัะพะปัะบะพ warmup ะปะพะณะธะบะฐ

2. โ **ะัะฐะฒะธะปัะฝัะต ะทะฐะฒะธัะธะผะพััะธ:**
   - main.py โ services โ storage โ
   - ะะตั ะธะผะฟะพััะพะฒ main.py โ nodes โ

3. โ **ะะพะดัะปัะฝะพััั:**
   - ะะฐะถะดัะน ัะตัะฒะธั ะฒ ัะฒะพะตะน ะฟะฐะฟะบะต
   - ะงะตัะบะธะต __init__.py ั ัะบัะฟะพััะฐะผะธ
   - ะะพะณะธัะฝะฐั ะณััะฟะฟะธัะพะฒะบะฐ ะฟะพ ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ

4. โ **ะงะธััะพัะฐ ะบะพะดะฐ:**
   - ะะตั ะฝะตะธัะฟะพะปัะทัะตะผัั ะธะผะฟะพััะพะฒ
   - ะะตั ะดัะฑะปะธัะพะฒะฐะฝะธั
   - ะงะตัะบะธะต ะธะผะตะฝะฐ ัะฐะนะปะพะฒ

---

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

### ะะตะบะพะผะตะฝะดัะตััั:
1. โ ะะตัะตัััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ: `pip install -r requirements.txt`
2. โ ะะตัะตะทะฐะฟัััะธัั ะฟัะธะปะพะถะตะฝะธะต
3. โ ะัะพะฒะตัะธัั `/admin/cache/status`
4. โ ะัะพะฒะตัะธัั `/admin/intents-registry`

### ะ ะฑัะดััะตะผ (ะพะฟัะธะพะฝะฐะปัะฝะพ):
- ๐ ะะพะฑะฐะฒะธัั ัะตััั ะดะปั `WarmupService`
- ๐ ะะพะฑะฐะฒะธัั ัะตััั ะดะปั `admin_routes`
- ๐ ะะพะบัะผะตะฝัะธัะพะฒะฐัั admin API ะฒ OpenAPI

---

**ะััะตั ะฟะพะดะณะพัะพะฒะปะตะฝ:** 2026-01-09 15:55  
**ะัะต ะธะทะผะตะฝะตะฝะธั ะฟัะพะฒะตัะตะฝั ะธ ะณะพัะพะฒั ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั** โ
