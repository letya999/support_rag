# Pipeline Node Execution Order
# This file defines the standard sequence of nodes in the RAG pipeline
# Modify this file to change the order of nodes in the generated pipeline_config.yaml
# 
# SECURITY NOTE: input_guardrails MUST execute BEFORE check_cache
# to prevent malicious content from bypassing safety via cached responses

pipeline_order:
  - session_starter
  - input_guardrails  # Blocks dangerous content BEFORE cache check
  - language_detection  # 1. Detect language first
  - query_translation   # 2. Translate to English for unified search & loop detection
  - check_cache         # 3. Check exact match cache (only for safe content)
  - cache_similarity    # 4. Optional: Check semantic similarity in cache (uses translations)
  - dialog_analysis     # 5. Uses translated_query for loop detection
  - aggregation
  - easy_classification
  - classify
  - metadata_filtering
  - expand_query
  - hybrid_search
  - retrieve
  - lexical_search
  - fusion            # CRITICAL: Requires 'retrieve' AND 'lexical_search'. No graceful degradation.
  - reranking
  - multihop
  - state_machine  # Moved here to have access to final confidence from reranking
  - routing
  - prompt_routing
  - generation
  - output_guardrails
  - archive_session
  - store_in_cache

