# Support RAG - –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞

**–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–∞–ø–æ–≤ 3-4 –ø–∞–π–ø–ª–∞–π–Ω–∞ Support RAG.**

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –≠—Ç–∞–ø—ã 1-2: –ó–ê–í–ï–†–®–ï–ù–û
- –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∏—Å–∫–∞: Hit Rate, MRR, Exact Match
- –ú–µ—Ç—Ä–∏–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: Faithfulness, Relevancy
- –§—Ä–µ–π–º–≤–æ—Ä–∫ –±–µ–Ω—á–º–∞—Ä–∫–∏–Ω–≥–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∫—Ä–∏–ø—Ç–∞–º–∏
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Langfuse
- –ü–∞–π–ø–ª–∞–π–Ω LangGraph: –ø–æ–∏—Å–∫ ‚Üí –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

---

## üéØ –≠–¢–ê–ü 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ç–µ–Ω—Ç–æ–≤ (~4 –¥–Ω—è)

### 3.1 –£–∑–µ–ª –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Zero-shot BERT)
**–ë–µ–∑ –æ–±—É—á–µ–Ω–∏—è. –ë–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.**

**–ß—Ç–æ:** –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–Ω—Ç–µ–Ω—Ç–∞–º –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –≤ –Ω–∞—á–∞–ª–µ –ø–∞–π–ø–ª–∞–π–Ω–∞.

**–ò–Ω—Ç–µ–Ω—Ç—ã:** reset_password, view_history, contact_support, check_policy, change_address, check_shipping_availability, track_order, check_payment_methods, cancel_subscription, company_info
**–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:** Account Access, Order Management, Support, Returns & Refunds, Shipping, Billing, Account Management, General Info

**–ö–∞–∫:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å zero-shot –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é `facebook/bart-large-mnli` (HuggingFace transformers)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è –∏–Ω—Ç–µ–Ω—Ç–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –ü—Ä–æ—Å—Ç–æ–π LRU –∫—ç—à –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –≤–æ–ø—Ä–æ—Å–æ–≤
- –ü–∞—Ç—Ç–µ—Ä–Ω Singleton –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
```
app/nodes/classification/
  ‚îú‚îÄ‚îÄ prompts.py        (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
  ‚îú‚îÄ‚îÄ classifier.py     (ClassificationService —Å –ª–æ–≥–∏–∫–æ–π zero-shot)
  ‚îú‚îÄ‚îÄ models.py         (Pydantic –º–æ–¥–µ–ª—å ClassificationOutput)
  ‚îî‚îÄ‚îÄ node.py          (–æ–±–µ—Ä—Ç–∫–∞ —É–∑–ª–∞ LangGraph)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å `app/pipeline/state.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å: intent, intent_confidence, category, category_confidence
- –û–±–Ω–æ–≤–∏—Ç—å `app/pipeline/graph.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å classify_node –∫–∞–∫ –°–¢–ê–†–¢–û–í–´–ô —É–∑–µ–ª
- –û–±–Ω–æ–≤–∏—Ç—å `requirements.txt` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å: transformers>=4.30.0, torch>=2.0.0

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (~100-200–º—Å, –±–µ–∑ –≤—ã–∑–æ–≤–æ–≤ API)
- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—Ö–æ–¥ = –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—ã—Ö–æ–¥)
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∏—Å–∫ —Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

---

### 3.2 –£–∑–µ–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (—Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —Å —Ñ–æ–ª–ª–±—ç–∫–æ–º)
**–£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.**

**–ß—Ç–æ:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏.

**–õ–æ–≥–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
```python
if category_confidence < 0.5:
    skip filtering ‚Üí –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
elif retrieve(category) returns >= 2 docs:
    –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
else:
    FALLBACK –Ω–∞ –ø–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ (–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
```

**–ö–∞–∫:**
- –û–±–Ω–æ–≤–∏—Ç—å `app/storage/vector_store.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `category_filter`
- –î–æ–±–∞–≤–∏—Ç—å SQL —É—Å–ª–æ–≤–∏–µ WHERE: `metadata->>'category' = %s`
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å –ª–æ–≥–∏–∫–æ–π —Ñ–æ–ª–ª–±—ç–∫–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ—à–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:**
```
app/nodes/metadata_filtering/
  ‚îú‚îÄ‚îÄ filtering.py      (MetadataFilteringService —Å —Ñ–æ–ª–ª–±—ç–∫–æ–º)
  ‚îú‚îÄ‚îÄ models.py         (FilteringOutput —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π)
  ‚îî‚îÄ‚îÄ node.py          (–æ–±–µ—Ä—Ç–∫–∞ —É–∑–ª–∞ LangGraph)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å `app/pipeline/state.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å: filter_used, fallback_triggered, filtering_reason
- –û–±–Ω–æ–≤–∏—Ç—å `app/pipeline/graph.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å metadata_filter_node –º–µ–∂–¥—É classify –∏ retrieve
- –û–±–Ω–æ–≤–∏—Ç—å `app/storage/vector_store.py` ‚Üí –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ category_filter

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ (—Ñ–æ–ª–ª–±—ç–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- ‚úÖ –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—à–µ–Ω–∏–π)

---

### 3.3 –£–ª—É—á—à–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
**–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫.**

**–¢–µ–∫—É—â–µ–µ:** `if confidence >= threshold ‚Üí auto_reply else ‚Üí handoff` (–±–∏–Ω–∞—Ä–Ω–æ)

**–ù–æ–≤–æ–µ:** 3-—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ü–µ–Ω–æ–∫ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
```python
if generation_confidence > 0.85 and faithfulness > 0.8:
    ‚Üí auto_reply
elif generation_confidence > 0.5:
    ‚Üí needs_review
else:
    ‚Üí escalation
```

**–ö–∞–∫:**
- –í—ã—á–∏—Å–ª–∏—Ç—å `generation_confidence = avg(faithfulness_score, relevancy_score)` –≤ route_node
- –£—á–µ—Å—Ç—å `fallback_triggered` (–±—ã—Ç—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ, –µ—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ñ–æ–ª–ª–±—ç–∫)
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è/–æ—Ç–ª–∞–¥–∫–∏

**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```
app/nodes/routing/
  ‚îú‚îÄ‚îÄ logic.py         (–æ–±–Ω–æ–≤–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É decide_action)
  ‚îî‚îÄ‚îÄ node.py         (–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ generation_confidence)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- –û–±–Ω–æ–≤–∏—Ç—å `app/pipeline/state.py` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å: generation_confidence, faithfulness_score, relevancy_score
- –û–±–Ω–æ–≤–∏—Ç—å `app/api/routes.py` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤—Å–µ –æ—Ü–µ–Ω–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ JSON `/ask`
- –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ 3+ –∏—Å—Ö–æ–¥–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –õ—É—á—à–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç—Ä–∏–∫)
- ‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (–≤–∏–¥–Ω—ã –≤—Å–µ –æ—Ü–µ–Ω–∫–∏)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ (—É—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–ª–∞–≥ —Ñ–æ–ª–ª–±—ç–∫–∞)

---

## üéØ –≠–¢–ê–ü 4: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —É–∑–ª—ã –ø–æ–∏—Å–∫–∞ (~5-7 –¥–Ω–µ–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è: –ü—Ä–∞–≤–∏–ª–∞ + –ì–∏–±—Ä–∏–¥ —Å LLM

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

---

### –í–∞—Ä–∏–∞–Ω—Ç A: –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ (~5-6 –¥–Ω–µ–π) ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø

**–ë—ã—Å—Ç—Ä–æ, –¥–µ—à–µ–≤–æ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω–∞.**

#### 4.1 –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–ª–µ–Ω–≥–∞ (0.5 –¥–Ω—è)
- –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å–ª–µ–Ω–≥–∞ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
- –ü—Ä–∏–º–µ—Ä: "pipe" ‚Üí "pipeline", "rejectable" ‚Üí "rejected records"
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ü—Ä–æ—Å—Ç–æ–π —Å–ª–æ–≤–∞—Ä—å + –∑–∞–º–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤
- –§–∞–π–ª: `app/nodes/slang_normalizer/normalizer.py`

#### 4.2 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–∏ (0.5 –¥–Ω—è)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pyspellchecker –∏–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É autocorrect)
- –ü—Ä–∏–º–µ—Ä: "configer" ‚Üí "configure"
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ + –¥–æ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
- –§–∞–π–ª: `app/nodes/spelling_correction/corrector.py`

#### 4.3 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (1 –¥–µ–Ω—å)
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –¥–æ–º–µ–Ω–Ω–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
- –ü—Ä–∏–º–µ—Ä: "return" ‚Üí ["refund", "send back", "money back"]
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: YAML —Å–ª–æ–≤–∞—Ä—å + —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- –§–∞–π–ª: `app/nodes/synonym_expansion/expander.py`

#### 4.4 –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª (2 –¥–Ω—è)
- –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Regex —à–∞–±–ª–æ–Ω–æ–≤ (–±–µ–∑ LLM!)
- –ü—Ä–∏–º–µ—Ä: "error: 404" ‚Üí –¥–æ–±–∞–≤–∏—Ç—å "troubleshooting", "debug", "fix"
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: Regex —à–∞–±–ª–æ–Ω—ã + –¥–≤–∏–∂–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
- –§–∞–π–ª: `app/nodes/rule_reformulation/engine.py`

#### 4.5 –ò–Ω—Ç–µ–Ω—Ç–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã (1 –¥–µ–Ω—å)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Ç–µ–Ω—Ç–∞/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ü—Ä–∏–º–µ—Ä: "order" (billing) vs "order" (shipping) ‚Üí —Ä–∞–∑–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –°–ª–æ–≤–∞—Ä—å —Å –∫–ª—é—á–∞–º–∏ –ø–æ –∏–Ω—Ç–µ–Ω—Ç–∞–º
- –§–∞–π–ª: `app/nodes/intent_synonyms/mapper.py`

**–ü–æ—Ä—è–¥–æ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
```
classify ‚Üí slang_normalizer ‚Üí spelling_correction ‚Üí
intent_aware_synonyms ‚Üí synonym_expansion ‚Üí
rule_reformulation ‚Üí metadata_filter ‚Üí retrieve
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—ã—Å—Ç—Ä–æ, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ, –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞.

---

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü–æ–ª–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (~7-9 –¥–Ω–µ–π)

**–í—Å—ë –∏–∑ –í–∞—Ä–∏–∞–Ω—Ç–∞ A + –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ LLM + —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è.**

–î–æ–±–∞–≤–∏—Ç—å –∫ –í–∞—Ä–∏–∞–Ω—Ç—É A:

#### 4.6 –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å LLM (1-2 –¥–Ω—è)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 2-3 –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º gpt-4o-mini
- –ò–∑—É—á–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: LangChain LLM + —à–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞
- –§–∞–π–ª: `app/nodes/llm_reformulation/reformulator.py`

#### 4.7 –ú–Ω–æ–≥–æ—Ö–æ–¥–æ–≤—ã–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è (Multi-Hop) (2-3 –¥–Ω—è)
- –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∏—Å–∫ —Ü–µ–ø–æ—á–µ–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ ‚Üí –ø–æ–∏—Å–∫ —Ç–æ–ø-1 ‚Üí –ø–æ–∏—Å–∫ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö ‚Üí –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –û—Ü–µ–Ω—â–∏–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ + —Ä–µ–∑–æ–ª–≤–µ—Ä —Ö–æ–ø–æ–≤
- –§–∞–π–ª—ã: `app/nodes/multihop/complexity_detector.py`, `hop_resolver.py`

#### 4.8 –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ (1 –¥–µ–Ω—å)
- –ü–æ–∏—Å–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ metadata.see_also
- –ü—Ä–∏–º–µ—Ä: FAQ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ "Return Policy" ‚Üí –∏–∑–≤–ª–µ—á—å –æ–±–∞
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –ü–∞—Ä—Å–µ—Ä —Å—Å—ã–ª–æ–∫ + –ø–∞–∫–µ—Ç–Ω—ã–π –ø–æ–∏—Å–∫
- –§–∞–π–ª: `app/nodes/cross_reference/resolver.py`

#### 4.9 –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (1 –¥–µ–Ω—å)
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ—Ö–æ–∂–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤–º–µ—Å—Ç–µ
- –£–º–µ–Ω—å—à–∞–µ—Ç –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å, –ª—É—á—à–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: –°—Ö–æ–¥—Å—Ç–≤–æ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ + –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è
- –§–∞–π–ª: `app/nodes/clustering/clusterer.py`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∏ –¥–æ—Ä–æ–∂–µ.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| | –í–∞—Ä–∏–∞–Ω—Ç A (–ù–∞ –ø—Ä–∞–≤–∏–ª–∞—Ö) | –í–∞—Ä–∏–∞–Ω—Ç B (–ü–æ–ª–Ω—ã–π) |
|---|---|---|
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö° –ë—ã—Å—Ç—Ä–æ (–Ω–µ—Ç –≤—ã–∑–æ–≤–æ–≤ API) | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–≤—ã–∑–æ–≤—ã LLM) |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | üí∞ –ó–∞ –∑–∞–ø—Ä–æ—Å |
| **–í—Ä–µ–º—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** | 5-6 –¥–Ω–µ–π | 7-9 –¥–Ω–µ–π |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** | –õ–µ–≥–∫–æ (–ø—Ä–æ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª–∞) | –°—Ä–µ–¥–Ω–µ (–ø—Ä–∞–≤–∏–ª–∞ + –ø—Ä–æ–º–ø—Ç—ã) |
| **–õ—É—á—à–µ –¥–ª—è** | –î–æ–º–µ–Ω–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | –û–±—â–∏–µ + —Å–ª–æ–∂–Ω—ã–µ Q&A |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** | –ü—Ä–æ—Å—Ç–∞—è | –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è |

---

## üîÑ –§–∏–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 3 (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
```
START ‚Üí classify ‚Üí metadata_filter ‚Üí retrieve ‚Üí
route ‚Üí [generate –∏–ª–∏ END]
```

### –ü–æ—Å–ª–µ –≠—Ç–∞–ø–∞ 4 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```
START ‚Üí slang_normalizer ‚Üí spelling_correction ‚Üí
classify ‚Üí intent_synonyms ‚Üí synonym_expansion ‚Üí
rule_reformulation ‚Üí metadata_filter ‚Üí retrieve ‚Üí
[rerank ‚Üí clustering ‚Üí cross_reference ‚Üí multihop] ‚Üí
merge_context ‚Üí generate ‚Üí route ‚Üí END
```

---

## üìù –°–≤–æ–¥–∫–∞ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞ –≠—Ç–∞–ø–µ 3:
```
app/nodes/classification/
  ‚îú‚îÄ‚îÄ __init__.py
  ‚îú‚îÄ‚îÄ prompts.py
  ‚îú‚îÄ‚îÄ classifier.py
  ‚îú‚îÄ‚îÄ models.py
  ‚îî‚îÄ‚îÄ node.py

app/nodes/metadata_filtering/
  ‚îú‚îÄ‚îÄ __init__.py
  ‚îú‚îÄ‚îÄ filtering.py
  ‚îú‚îÄ‚îÄ models.py
  ‚îî‚îÄ‚îÄ node.py
```

### –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –≠—Ç–∞–ø–µ 3:
```
app/pipeline/state.py        (–¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è)
app/pipeline/graph.py        (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ —É–∑–ª—ã)
app/nodes/routing/logic.py   (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –º–µ—Ç—Ä–∏–∫–∞–º)
app/nodes/routing/node.py    (–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫)
app/storage/vector_store.py  (—Ñ–∏–ª—å—Ç—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
app/api/routes.py            (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã)
requirements.txt             (transformers, torch)
```

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞ –≠—Ç–∞–ø–µ 4 (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ):
```
–í–∞—Ä–∏–∞–Ω—Ç A (5 –Ω–∞–±–æ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤):
- app/nodes/slang_normalizer/
- app/nodes/spelling_correction/
- app/nodes/synonym_expansion/
- app/nodes/rule_reformulation/
- app/nodes/intent_synonyms/

–í–∞—Ä–∏–∞–Ω—Ç B (9 –Ω–∞–±–æ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤):
- –í—Å–µ –∏–∑ –í–∞—Ä–∏–∞–Ω—Ç–∞ A +
- app/nodes/llm_reformulation/
- app/nodes/multihop/
- app/nodes/cross_reference/
- app/nodes/clustering/
```

---

## ‚è±Ô∏è –¢–∞–π–º–ª–∞–π–Ω

```
–≠—Ç–∞–ø 3 (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): 4 –¥–Ω—è
  - 3.1 –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è: 1-2 –¥–Ω—è
  - 3.2 –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: 1-2 –¥–Ω—è
  - 3.3 –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è: 0.5 –¥–Ω—è
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 0.5 –¥–Ω—è

–≠—Ç–∞–ø 4 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  - –í–∞—Ä–∏–∞–Ω—Ç A: 5-6 –¥–Ω–µ–π
  - –í–∞—Ä–∏–∞–Ω—Ç B: 7-9 –¥–Ω–µ–π
  - –í—ã–±–æ—Ä–æ—á–Ω–æ (–≤—ã–±—Ä–∞—Ç—å 2-3 —É–∑–ª–∞): 2-3 –¥–Ω—è

–ò—Ç–æ–≥–æ: –≠—Ç–∞–ø 3 (4 –¥–Ω—è) + –≠—Ç–∞–ø 4 A (5-6 –¥–Ω–µ–π) = 9-10 –¥–Ω–µ–π –¥–ª—è MVP
```

---

## ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –£—Å–ø–µ—Ö –≠—Ç–∞–ø–∞ 3:
- ‚úÖ –¢–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: >90% –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –Ω–∞–±–æ—Ä–µ
- ‚úÖ –î–æ–ª—è —Ñ–æ–ª–ª–±—ç–∫–∞: <30% (—Ñ–∏–ª—å—Ç—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç)
- ‚úÖ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è: 3-—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –í—Å–µ –æ—Ü–µ–Ω–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ API

### –£—Å–ø–µ—Ö –≠—Ç–∞–ø–∞ 4A (–ù–∞ –ø—Ä–∞–≤–∏–ª–∞—Ö):
- ‚úÖ –ù–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ API (–±—ã—Å—Ç—Ä–æ)
- ‚úÖ –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚úÖ –õ–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å
- ‚úÖ ~30-40% —É–ª—É—á—à–µ–Ω–∏–µ recall

### –£—Å–ø–µ—Ö –≠—Ç–∞–ø–∞ 4B (–ü–æ–ª–Ω—ã–π):
- ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (multi-hop)
- ‚úÖ –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
- ‚úÖ ~50-60% —É–ª—É—á—à–µ–Ω–∏–µ recall
- ‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ù–∞—á–∞—Ç—å —Å:** –≠—Ç–∞–ø 3 (4 –¥–Ω—è) + –í–∞—Ä–∏–∞–Ω—Ç A (5-6 –¥–Ω–µ–π) = **9-10 –¥–Ω–µ–π –≤—Å–µ–≥–æ**

–≠—Ç–æ –¥–∞—Å—Ç –≤–∞–º:
- ‚úÖ –ì–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–Ω—É support RAG
- ‚úÖ –ë—ã—Å—Ç—Ä–æ –∏ –¥–µ—à–µ–≤–æ (–Ω–µ—Ç –≤—ã–∑–æ–≤–æ–≤ LLM –¥–ª—è –ø–æ–∏—Å–∫–∞)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –¥–æ–º–µ–Ω–∞
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å

–ó–∞—Ç–µ–º –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ LLM (4.6, 4.7), –µ—Å–ª–∏ —É–≤–∏–¥–∏—Ç–µ —Ü–µ–Ω–Ω–æ—Å—Ç—å.

---

## üìö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:
- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞
- –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é/README –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –í—ã–±—Ä–∞—Ç—å –≠—Ç–∞–ø 3 (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∫ –≠—Ç–∞–ø—É 4
2. –í—ã–±—Ä–∞—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –≠—Ç–∞–ø–∞ 4 (A, B –∏–ª–∏ –≤—ã–±–æ—Ä–æ—á–Ω–æ)
3. –°–æ–∑–¥–∞—Ç—å —Ñ–∏—á–∞-–≤–µ—Ç–∫—É –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–∑–ª—ã –≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–º –ø–æ—Ä—è–¥–∫–µ
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å –Ω–∞–±–æ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö ground truth
6. –°–æ–∑–¥–∞—Ç—å PR —Å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
