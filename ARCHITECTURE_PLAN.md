# –ü–ª–∞–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ RAG Pipeline

## –í—ã–≤–æ–¥—ã

‚úÖ **–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —É–∑–ª–æ–≤ (70%) –≥–∏–±–∫–∏–µ** –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

‚ùå **5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∂–µ—Å—Ç–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –Ω–∞—Ä—É—à–∞—Ç—å:

1. `session_starter` ‚Üí `input_guardrails` ‚Üí `check_cache` (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
2. `retrieve` + `lexical_search` ‚Üí `fusion` (—Ç—Ä–µ–±—É–µ—Ç –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏)
3. `reranking` ‚Üí `state_machine` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç confidence)
4. `state_machine` ‚Üí `routing` (—Ç—Ä–µ–±—É–µ—Ç action_recommendation)
5. `routing` ‚Üí `generation/END` (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º)

---

## –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò (–¥–µ–ª–∞—Ç—å —Å–µ–π—á–∞—Å)

- [ ] **–†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É fusion** - —Ç—Ä–µ–±—É–µ—Ç –æ–±–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –±–µ–∑ graceful degradation
  - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ graph.py
  - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ pipeline_order.yaml

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –≤ docstrings** –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞
  - –¢—Ä–µ–±—É–µ–º—ã–µ –≤—Ö–æ–¥—ã
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤—Ö–æ–¥—ã
  - –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤—ã—Ö–æ–¥—ã

- [ ] **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é pipeline_order.yaml** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã

### üü° –í–´–°–û–ö–ò–ô (—Å–ª–µ–¥—É—é—â–∏–π —Å–ø—Ä–∏–Ω—Ç)

- [ ] –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–∏—Å–µ–π –ø–æ–ª—è `docs`
- [ ] –î–æ–±–∞–≤–∏—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —É–∑–ª–æ–≤
- [ ] –°–¥–µ–ª–∞—Ç—å `confidence` –≤ state_machine –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

### üü¢ –°–†–ï–î–ù–ò–ô (–±—É–¥—É—â–µ–µ)

- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (—è–∑—ã–∫ + –∞–Ω–∞–ª–∏–∑ –¥–∏–∞–ª–æ–≥–∞) - –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª 35% —É—Å–∫–æ—Ä–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å skip logic –¥–ª—è multihop –ø—Ä–∏ high confidence
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –≤ Langfuse
- [ ] –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å graceful degradation –≤ fusion

---

## –£–∑–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –ú–û–ñ–ù–û –º–µ–Ω—è—Ç—å (70%)

–ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ:
- `language_detection` (–∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç question)
- `output_guardrails` (–∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç answer)
- `archive_session` (–∫–æ–Ω–µ—Ü pipeline)
- `store_in_cache` (–∫–æ–Ω–µ—Ü pipeline)

–£—Å–ª–æ–≤–Ω–æ –≥–∏–±–∫–∏–µ:
- `aggregation` (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ/–ø–æ—Å–ª–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- `easy_classification` (–º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ aggregation)
- `expand_query` (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ/–ø–æ—Å–ª–µ –ø–æ–∏—Å–∫–∞)

---

## –£–∑–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –ù–ï–õ–¨–ó–Ø –º–µ–Ω—è—Ç—å (30%)

- `input_guardrails` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ check_cache)
- `check_cache` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ guardrails)
- `state_machine` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥ routing)
- `routing` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ—Å–ª–µ state_machine)
- `fusion` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - —Ç—Ä–µ–±—É–µ—Ç retrieve + lexical_search)

---

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Fusion** - –Ω–µ—Ç graceful degradation –µ—Å–ª–∏ missing results
2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–ø–∏—Å–∏ docs** - –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç –æ—Ç–ª–∞–¥–∫—É
3. **State Machine —Ç—Ä–µ–±—É–µ—Ç confidence** - –º–æ–∂–µ—Ç –±—ã—Ç—å None –≤ –Ω–∞—á–∞–ª–µ
4. **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤** - —É–∑–ª—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤—Ö–æ–¥—ã

